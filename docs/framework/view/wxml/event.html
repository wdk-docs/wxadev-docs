

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>事件 &mdash; wxadev 1.0.0 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="next" title="view/wxml/import" href="import.html" />
    <link rel="prev" title="view/wxml/data" href="data.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../contents.html" class="icon icon-home"> wxadev
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">开发指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev.html">简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basic/index.html">基础教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/index.html">运行环境</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">框架</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../MINA.html">框架</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../structure.html">目录结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config.html">小程序配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sitemap.html">sitemap 配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-service/index.html">逻辑层 App Service</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">视图</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../wxss.html">WXSS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../selector.html">获取界面上的节点信息</a></li>
<li class="toctree-l3"><a class="reference internal" href="../resizable.html">响应显示区域变化</a></li>
<li class="toctree-l3"><a class="reference internal" href="../interactive-animation.html">WXS响应事件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../component.html">基础组件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../animation.html">动画</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wxs/index.html">WXS</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">WXML</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="conditional.html">view/wxml/conditional</a></li>
<li class="toctree-l4"><a class="reference internal" href="data.html">view/wxml/data</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">事件</a></li>
<li class="toctree-l4"><a class="reference internal" href="import.html">view/wxml/import</a></li>
<li class="toctree-l4"><a class="reference internal" href="list.html">view/wxml/list</a></li>
<li class="toctree-l4"><a class="reference internal" href="template.html">view/wxml/template</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../details.html">运行环境</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugin/index.html">插件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ability/index.html">基础能力</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../device/index.html">硬件能力</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../open-ability/index.html">开放能力</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usability.html">调试</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usability/index.html">usability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usability/index.html#id1">视图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../performance.html">性能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../performance/index.html">performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client-lib/index.html">client-lib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../compatibility.html">兼容处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../workers.html">workers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../server-ability/index.html">server-ability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release/index.html">release</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operating-mechanism.html">小程序运行机制</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../custom-component/index.html">custom-component</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../component/index.html">组件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api-backend/index.html">服务端API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devtools/index.html">开发工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">参考资料</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../wxcloud/index.html">云开发</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../wxwork/index.html">企业微信兼容</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">术语</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../contents.html">wxadev</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">框架</a> &raquo;</li>
        
          <li><a href="../index.html">视图</a> &raquo;</li>
        
          <li><a href="index.html">WXML</a> &raquo;</li>
        
      <li>事件</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/framework/view/wxml/event.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1><a class="reference external" href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/template.html">事件</a><a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<p>什么是事件
事件是视图层到逻辑层的通讯方式。
事件可以将用户的行为反馈到逻辑层进行处理。
事件可以绑定在组件上，当达到触发事件，就会执行逻辑层中对应的事件处理函数。
事件对象可以携带额外信息，如 id, dataset, touches。
事件的使用方式
在组件中绑定一个事件处理函数。
如bindtap，当用户点击该组件的时候会在该页面对应的Page中找到相应的事件处理函数。</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span>&lt;view id=&quot;tapTest&quot; data-hi=&quot;WeChat&quot; bindtap=&quot;tapName&quot;&gt;Click me!&lt;/view&gt;
</pre></div>
</div>
<p>在相应的Page定义中写上相应的事件处理函数，参数是event。</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Page</span><span class="p">({</span>
  <span class="nx">tapName</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
</pre></div>
</div>
<p>可以看到log出来的信息大致如下：</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;tap&quot;</span><span class="p">,</span>
  <span class="s2">&quot;timeStamp&quot;</span><span class="o">:</span> <span class="mi">895</span><span class="p">,</span>
  <span class="s2">&quot;target&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;tapTest&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dataset&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;hi&quot;</span><span class="o">:</span> <span class="s2">&quot;WeChat&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;currentTarget&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;tapTest&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dataset&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;hi&quot;</span><span class="o">:</span> <span class="s2">&quot;WeChat&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;detail&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;x&quot;</span><span class="o">:</span> <span class="mi">53</span><span class="p">,</span>
    <span class="s2">&quot;y&quot;</span><span class="o">:</span> <span class="mi">14</span>
  <span class="p">},</span>
  <span class="s2">&quot;touches&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;identifier&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;pageX&quot;</span><span class="o">:</span> <span class="mi">53</span><span class="p">,</span>
      <span class="s2">&quot;pageY&quot;</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
      <span class="s2">&quot;clientX&quot;</span><span class="o">:</span> <span class="mi">53</span><span class="p">,</span>
      <span class="s2">&quot;clientY&quot;</span><span class="o">:</span> <span class="mi">14</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">&quot;changedTouches&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;identifier&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;pageX&quot;</span><span class="o">:</span> <span class="mi">53</span><span class="p">,</span>
      <span class="s2">&quot;pageY&quot;</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
      <span class="s2">&quot;clientX&quot;</span><span class="o">:</span> <span class="mi">53</span><span class="p">,</span>
      <span class="s2">&quot;clientY&quot;</span><span class="o">:</span> <span class="mi">14</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>使用WXS函数响应事件
基础库 2.4.4 开始支持，低版本需做兼容处理。</p>
<p>从基础库版本2.4.4开始，支持使用WXS函数绑定事件，WXS函数接受2个参数，第一个是event，在原有的event的基础上加了event.instance对象，第二个参数是ownerInstance，和event.instance一样是一个ComponentDescriptor对象。具体使用如下：</p>
<p>在组件中绑定和注册事件处理的WXS函数。</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span>&lt;wxs module=&quot;wxs&quot; src=&quot;./test.wxs&quot;&gt;&lt;/wxs&gt;
&lt;view id=&quot;tapTest&quot; data-hi=&quot;WeChat&quot; bindtap=&quot;{{wxs.tapName}}&quot;&gt;Click me!&lt;/view&gt;
**注：绑定的WXS函数必须用{{}}括起来**
test.wxs文件实现tapName函数
function tapName(event, ownerInstance) {
  console.log(&#39;tap wechat&#39;, JSON.stringify(event))
}
module.exports = {
  tapName: tapName
}
</pre></div>
</div>
<p>ownerInstance包含了一些方法，可以设置组件的样式和class，具体包含的方法以及为什么要用WXS函数响应事件，请点击查看详情。</p>
<p>事件详解
事件分类
事件分为冒泡事件和非冒泡事件：</p>
<p>冒泡事件：当一个组件上的事件被触发后，该事件会向父节点传递。
非冒泡事件：当一个组件上的事件被触发后，该事件不会向父节点传递。
WXML的冒泡事件列表：</p>
<p>类型      触发条件    最低版本
touchstart      手指触摸动作开始
touchmove       手指触摸后移动
touchcancel     手指触摸动作被打断，如来电提醒，弹窗
touchend        手指触摸动作结束
tap     手指触摸后马上离开
longpress       手指触摸后，超过350ms再离开，如果指定了事件回调函数并触发了这个事件，tap事件将不被触发 1.5.0
longtap 手指触摸后，超过350ms再离开（推荐使用longpress事件代替）
transitionend   会在 WXSS transition 或 wx.createAnimation 动画结束后触发
animationstart  会在一个 WXSS animation 动画开始时触发
animationiteration      会在一个 WXSS animation 一次迭代结束时触发
animationend    会在一个 WXSS animation 动画完成时触发
touchforcechange        在支持 3D Touch 的 iPhone 设备，重按时会触发 1.9.90
注：除上表之外的其他组件自定义事件如无特殊声明都是非冒泡事件，如&lt;form/&gt;的submit事件，&lt;input/&gt;的input事件，&lt;scroll-view/&gt;的scroll事件，(详见各个组件)</p>
<p>事件绑定和冒泡
事件绑定的写法同组件的属性，以 key、value 的形式。</p>
<p>key 以bind或catch开头，然后跟上事件的类型，如bindtap、catchtouchstart。自基础库版本 1.5.0 起，在非原生组件中，bind和catch后可以紧跟一个冒号，其含义不变，如bind:tap、catch:touchstart。
value 是一个字符串，需要在对应的 Page 中定义同名的函数。不然当触发事件的时候会报错。
bind事件绑定不会阻止冒泡事件向上冒泡，catch事件绑定可以阻止冒泡事件向上冒泡。</p>
<p>如在下边这个例子中，点击 inner view 会先后调用handleTap3和handleTap2(因为tap事件会冒泡到 middle view，而 middle view 阻止了 tap 事件冒泡，不再向父节点传递)，点击 middle view 会触发handleTap2，点击 outer view 会触发handleTap1。</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span>&lt;view id=&quot;outer&quot; bindtap=&quot;handleTap1&quot;&gt;
  outer view
  &lt;view id=&quot;middle&quot; catchtap=&quot;handleTap2&quot;&gt;
    middle view
    &lt;view id=&quot;inner&quot; bindtap=&quot;handleTap3&quot;&gt;
      inner view
    &lt;/view&gt;
  &lt;/view&gt;
&lt;/view&gt;
</pre></div>
</div>
<p>事件的捕获阶段
自基础库版本 1.5.0 起，触摸类事件支持捕获阶段。捕获阶段位于冒泡阶段之前，且在捕获阶段中，事件到达节点的顺序与冒泡阶段恰好相反。需要在捕获阶段监听事件时，可以采用capture-bind、capture-catch关键字，后者将中断捕获阶段和取消冒泡阶段。</p>
<p>在下面的代码中，点击 inner view 会先后调用handleTap2、handleTap4、handleTap3、handleTap1。</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span>&lt;view
  id=&quot;outer&quot;
  bind:touchstart=&quot;handleTap1&quot;
  capture-bind:touchstart=&quot;handleTap2&quot;
&gt;
  outer view
  &lt;view
    id=&quot;inner&quot;
    bind:touchstart=&quot;handleTap3&quot;
    capture-bind:touchstart=&quot;handleTap4&quot;
  &gt;
    inner view
  &lt;/view&gt;
&lt;/view&gt;
</pre></div>
</div>
<p>如果将上面代码中的第一个capture-bind改为capture-catch，将只触发handleTap2。</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span>&lt;view
  id=&quot;outer&quot;
  bind:touchstart=&quot;handleTap1&quot;
  capture-catch:touchstart=&quot;handleTap2&quot;
&gt;
  outer view
  &lt;view
    id=&quot;inner&quot;
    bind:touchstart=&quot;handleTap3&quot;
    capture-bind:touchstart=&quot;handleTap4&quot;
  &gt;
    inner view
  &lt;/view&gt;
&lt;/view&gt;
</pre></div>
</div>
<p>事件对象
如无特殊说明，当组件触发事件时，逻辑层绑定该事件的处理函数会收到一个事件对象。</p>
<p>BaseEvent 基础事件对象属性列表：</p>
<p>属性      类型      说明
type    String  事件类型
timeStamp       Integer 事件生成时的时间戳
target  Object  触发事件的组件的一些属性值集合
currentTarget   Object  当前组件的一些属性值集合
CustomEvent 自定义事件对象属性列表（继承 BaseEvent）：</p>
<p>属性      类型      说明
detail  Object  额外的信息
TouchEvent 触摸事件对象属性列表（继承 BaseEvent）：</p>
<p>属性      类型      说明
touches Array   触摸事件，当前停留在屏幕中的触摸点信息的数组
changedTouches  Array   触摸事件，当前变化的触摸点信息的数组
特殊事件： &lt;canvas&gt; 中的触摸事件不可冒泡，所以没有 currentTarget。</p>
<p>type
代表事件的类型。</p>
<p>timeStamp
页面打开到触发事件所经过的毫秒数。</p>
<p>target
触发事件的源组件。</p>
<p>属性      类型      说明
id      String  事件源组件的id
tagName String  当前组件的类型
dataset Object  事件源组件上由data-开头的自定义属性组成的集合
currentTarget
事件绑定的当前组件。</p>
<p>属性      类型      说明
id      String  当前组件的id
tagName String  当前组件的类型
dataset Object  当前组件上由data-开头的自定义属性组成的集合
说明： target 和 currentTarget 可以参考上例中，点击 inner view 时，handleTap3 收到的事件对象 target 和 currentTarget 都是 inner，而 handleTap2 收到的事件对象 target 就是 inner，currentTarget 就是 middle。</p>
<p>dataset
在组件中可以定义数据，这些数据将会通过事件传递给 SERVICE。 书写方式： 以data-开头，多个单词由连字符-链接，不能有大写(大写会自动转成小写)如data-element-type，最终在 event.currentTarget.dataset 中会将连字符转成驼峰elementType。</p>
<p>示例：</p>
<p>touches
touches 是一个数组，每个元素为一个 Touch 对象（canvas 触摸事件中携带的 touches 是 CanvasTouch 数组）。 表示当前停留在屏幕上的触摸点。</p>
<p>Touch 对象
属性      类型      说明
identifier      Number  触摸点的标识符
pageX, pageY    Number  距离文档左上角的距离，文档的左上角为原点 ，横向为X轴，纵向为Y轴
clientX, clientY        Number  距离页面可显示区域（屏幕除去导航条）左上角距离，横向为X轴，纵向为Y轴
CanvasTouch 对象
属性      类型      说明      特殊说明
identifier      Number  触摸点的标识符
x, y    Number  距离 Canvas 左上角的距离，Canvas 的左上角为原点 ，横向为X轴，纵向为Y轴
changedTouches
changedTouches 数据格式同 touches。 表示有变化的触摸点，如从无变有（touchstart），位置变化（touchmove），从有变无（touchend、touchcancel）。</p>
<p>detail
自定义事件所携带的数据，如表单组件的提交事件会携带用户的输入，媒体的错误事件会携带错误信息，详见组件定义中各个事件的定义。</p>
<p>点击事件的detail 带有的 x, y 同 pageX, pageY 代表距离文档左上角的距离。</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="import.html" class="btn btn-neutral float-right" title="view/wxml/import" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="data.html" class="btn btn-neutral float-left" title="view/wxml/data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Nosy

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>