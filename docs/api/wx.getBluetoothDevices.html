
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <title>wx.getBluetoothDevices &#8212; wxadev 1.0.0 文档</title>
    <link rel="stylesheet" href="../_static/sphinx13.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 wxadev 1.0.0 文档 中搜索"
          href="../_static/opensearch.xml"/>

    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="wx.getBluetoothAdapterState" href="wx.getBluetoothAdapterState.html" />
    <link rel="prev" title="wx.getConnectedBluetoothDevices" href="wx.getConnectedBluetoothDevices.html" />
<link rel="canonical" href="http://www.sphinx-doc.org/en/master/api/wx.getBluetoothDevices.html" />

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet" type="text/css" />
 
<style type="text/css">
  table.right { float: right; margin-left: 20px; }
  table.right td { border: 1px solid #ccc; }
  
</style>
<script type="text/javascript">
  // intelligent scrolling of the sidebar content
  $(window).scroll(function() {
    var sb = $('.sphinxsidebarwrapper');
    var win = $(window);
    var sbh = sb.height();
    var offset = $('.sphinxsidebar').position()['top'];
    var wintop = win.scrollTop();
    var winbot = wintop + win.innerHeight();
    var curtop = sb.position()['top'];
    var curbot = curtop + sbh;
    // does sidebar fit in window?
    if (sbh < win.innerHeight()) {
      // yes: easy case -- always keep at the top
      sb.css('top', $u.min([$u.max([0, wintop - offset - 10]), $(document).height() - sbh - 200]));
    } else {
      // no: only scroll if top/bottom edge of sidebar is at
      // top/bottom edge of window
      if (curtop > wintop && curbot > winbot) {
        sb.css('top', $u.max([wintop - offset - 10, 0]));
      } else if (curtop < wintop && curbot < winbot) {
        sb.css('top', $u.min([winbot - sbh - offset - 20, $(document).height() - sbh - 200]));
      }
    }
  });
</script> 
  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="../index.html">主页</a></li>
    <li><a href="../basic/index.html">入门</a></li>
    <li><a href="../framework/index.html">框架</a></li>
    <li><a href="../component/index.html">组件</a></li>
    <li><a href="index.html">API</a></li>
    <li><a href="../api-backend/index.html">服务端</a></li>
    <li><a href="../reference/index.html">参考</a></li>
    <li><a href="../contents.html">目录</a></li>
  </ul>
  <div>
    <a href="../index.html">
      <img src="../_static/wxaheader.png" alt="wxa" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../http-routingtable.html" title="微信小程序API"
             >wxapi</a> |</li>
        <li class="right" >
          <a href="wx.getBluetoothAdapterState.html" title="wx.getBluetoothAdapterState"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="wx.getConnectedBluetoothDevices.html" title="wx.getConnectedBluetoothDevices"
             accesskey="P">上一页</a> |</li>
<li><a href="../index.html">主页</a>&#160;|</li>
<li><a href="../contents.html">文档</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">API</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>上一个主题</h4>
  <p class="topless"><a href="wx.getConnectedBluetoothDevices.html"
                        title="上一章">wx.getConnectedBluetoothDevices</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="wx.getBluetoothAdapterState.html"
                        title="下一章">wx.getBluetoothAdapterState</a></p>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/wx.getBluetoothDevices.rst.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="wx-getbluetoothdevices">
<h1><a class="reference external" href="https://developers.weixin.qq.com/miniprogram/dev/api/wx.getBluetoothDevices.html">wx.getBluetoothDevices</a><a class="headerlink" href="#wx-getbluetoothdevices" title="永久链接至标题">¶</a></h1>
<dl class="function">
<dt id="wx.getBluetoothDevices">
<code class="descclassname">wx.</code><code class="descname">getBluetoothDevices</code><span class="sig-paren">(</span><em>Object object</em><span class="sig-paren">)</span><a class="headerlink" href="#wx.getBluetoothDevices" title="永久链接至目标">¶</a></dt>
<dd><div class="versionadded">
<p><span class="versionmodified added">1.1.0 新版功能: </span>低版本需做 <a class="reference internal" href="../framework/compatibility.html#compatibility"><span class="std std-ref">兼容处理</span></a> 。</p>
</div>
</dd></dl>

<p>获取在蓝牙模块生效期间所有已发现的蓝牙设备。包括已经和本机处于连接状态的设备。</p>
<p>参数
Object object
属性      类型      默认值     必填      说明
success function                否       接口调用成功的回调函数
fail    function                否       接口调用失败的回调函数
complete        function                否       接口调用结束的回调函数（调用成功、失败都会执行）
object.success 回调函数
参数
Object res
属性      类型      说明
devices Array.&lt;Object&gt;  uuid 对应的的已连接设备列表
res.devices 的结构</p>
<p>属性      类型      说明
name    string  蓝牙设备名称，某些设备可能没有
deviceId        string  用于区分设备的 id
RSSI    number  当前蓝牙设备的信号强度
advertisData    ArrayBuffer     当前蓝牙设备的广播数据段中的 ManufacturerData 数据段。
advertisServiceUUIDs    Array.&lt;string&gt;  当前蓝牙设备的广播数据段中的 ServiceUUIDs 数据段
localName       string  当前蓝牙设备的广播数据段中的 LocalName 数据段
serviceData     Object  当前蓝牙设备的广播数据段中的 ServiceData 数据段
错误
错误码     错误信息    说明
0       ok      正常
10000   not init        未初始化蓝牙适配器
10001   not available   当前蓝牙适配器不可用
10002   no device       没有找到指定设备
10003   connection fail 连接失败
10004   no service      没有找到指定服务
10005   no characteristic       没有找到指定特征值
10006   no connection   当前连接已断开
10007   property not support    当前特征值不支持此操作
10008   system error    其余所有系统上报的异常
10009   system not support      Android 系统特有，系统版本低于 4.3 不支持 BLE
10012   operate time out        连接超时
10013   invalid_data    连接 deviceId 为空或者是格式不正确
示例代码
在开发者工具中预览效果</p>
<p>// ArrayBuffer转16进度字符串示例
function ab2hex(buffer) {</p>
<blockquote>
<div><dl>
<dt>const hexArr = Array.prototype.map.call(</dt><dd><p>new Uint8Array(buffer),
function (bit) {</p>
<blockquote>
<div><p>return (‘00’ + bit.toString(16)).slice(-2)</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>)
return hexArr.join(‘’)</p>
</div></blockquote>
<p>}
wx.getBluetoothDevices({</p>
<blockquote>
<div><dl>
<dt>success(res) {</dt><dd><p>console.log(res)
if (res.devices[0]) {</p>
<blockquote>
<div><p>console.log(ab2hex(res.devices[0].advertisData))</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>})
注意事项
该接口获取到的设备列表为蓝牙模块生效期间所有搜索到的蓝牙设备，若在蓝牙模块使用流程结束后未及时调用 wx.closeBluetoothAdapter 释放资源，会存在调用该接口会返回之前的蓝牙使用流程中搜索到的蓝牙设备，可能设备已经不在用户身边，无法连接。
蓝牙设备在被搜索到时，系统返回的 name 字段一般为广播包中的 LocalName 字段中的设备名称，而如果与蓝牙设备建立连接，系统返回的 name 字段会改为从蓝牙设备上获取到的 GattName。若需要动态改变设备名称并展示，建议使用 localName 字段。</p>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="../http-routingtable.html" title="微信小程序API"
             >wxapi</a> |</li>
        <li class="right" >
          <a href="wx.getBluetoothAdapterState.html" title="wx.getBluetoothAdapterState"
             >下一页</a> |</li>
        <li class="right" >
          <a href="wx.getConnectedBluetoothDevices.html" title="wx.getConnectedBluetoothDevices"
             >上一页</a> |</li>
<li><a href="../index.html">主页</a>&#160;|</li>
<li><a href="../contents.html">文档</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >API</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2019, Wxadev Docs.
      由 <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.0+/529a72d 创建。
    </div>
  </body>
</html>