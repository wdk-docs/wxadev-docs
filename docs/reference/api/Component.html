
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>创建自定义组件(Component) &#8212; wxadev v2.21.0 文档</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx13.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/translations.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 wxadev v2.21.0 文档 中搜索"
          href="../../_static/opensearch.xml"/>

    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="Behavior" href="Behavior.html" />
    <link rel="prev" title="获取当前页面栈(getCurrentPages)" href="getCurrentPages.html" />
<link rel="canonical" href="http://www.sphinx-doc.org/en/master/reference/api/Component.html" />

<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet" type="text/css" />
 
<style type="text/css">
  table.right { float: right; margin-left: 20px; }
  table.right td { border: 1px solid #ccc; }
  
</style>
<script type="text/javascript">
  // intelligent scrolling of the sidebar content
  $(window).scroll(function() {
    var sb = $('.sphinxsidebarwrapper');
    var win = $(window);
    var sbh = sb.height();
    var offset = $('.sphinxsidebar').position()['top'];
    var wintop = win.scrollTop();
    var winbot = wintop + win.innerHeight();
    var curtop = sb.position()['top'];
    var curbot = curtop + sbh;
    // does sidebar fit in window?
    if (sbh < win.innerHeight()) {
      // yes: easy case -- always keep at the top
      sb.css('top', $u.min([$u.max([0, wintop - offset - 10]), $(document).height() - sbh - 200]));
    } else {
      // no: only scroll if top/bottom edge of sidebar is at
      // top/bottom edge of window
      if (curtop > wintop && curbot > winbot) {
        sb.css('top', $u.max([wintop - offset - 10, 0]));
      } else if (curtop < wintop && curbot < winbot) {
        sb.css('top', $u.min([winbot - sbh - offset - 20, $(document).height() - sbh - 200]));
      }
    }
  });
</script> 
  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="../../index.html">主页</a></li>
    <li><a href="../../basic/index.html">入门</a></li>
    <li><a href="../../framework/index.html">框架</a></li>
    <li><a href="../../component/index.html">组件</a></li>
    <li><a href="../../api/index.html">API</a></li>
    <li><a href="../../api-backend/index.html">服务端</a></li>
    <li><a href="../index.html">参考</a></li>
    <li><a href="../../contents.html">目录</a></li>
  </ul>
  <div>
    <a href="../../index.html">
      <img src="../../_static/wxaheader.png" alt="wxa" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../../http-routingtable.html" title="微信小程序API"
             >wxapi</a> |</li>
        <li class="right" >
          <a href="Behavior.html" title="Behavior"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="getCurrentPages.html" title="获取当前页面栈(getCurrentPages)"
             accesskey="P">上一页</a> |</li>
<li><a href="../../index.html">主页</a>&#160;|</li>
<li><a href="../../contents.html">文档</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" >参考资料</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">框架接口说明</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">创建自定义组件(Component)</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>上一个主题</h4>
  <p class="topless"><a href="getCurrentPages.html"
                        title="上一章">获取当前页面栈(getCurrentPages)</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="Behavior.html"
                        title="下一章">Behavior</a></p>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/reference/api/Component.rst.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="component">
<h1><a class="reference external" href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/Component.html">创建自定义组件(Component)</a><a class="headerlink" href="#component" title="永久链接至标题">¶</a></h1>
<dl class="js class">
<dt class="sig sig-object js" id="Component">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">Component</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Object</span> <span class="pre">object</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Component" title="永久链接至目标">¶</a></dt>
<dd><p>创建自定义组件，接受一个 Object 类型的参数。</p>
<dl class="field-list simple">
<dt class="field-odd">参数</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>properties</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">object()</span></code></span>) – Object Map      否       组件的对外属性，是属性名到属性设置的映射表</p></li>
<li><p><strong>data</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">object()</span></code></span>) – 组件的内部数据，和 properties 一同用于组件的模板渲染</p></li>
<li><p><strong>observers</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">object()</span></code></span>) – 组件数据字段监听器，用于监听 properties 和 data 的变化，参见 数据监听器   2.6.1</p></li>
<li><p><strong>methods</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">object()</span></code></span>) – 组件的方法，包括事件响应函数和任意的自定义方法，关于事件响应函数的使用，参见 组件间通信与事件</p></li>
<li><p><strong>behaviors</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">string()</span></code></span>) – Array  否       类似于mixins和traits的组件间代码复用机制，参见 behaviors</p></li>
<li><p><strong>created</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">function()</span></code></span>) – 组件生命周期函数-在组件实例刚刚被创建时执行，注意此时不能调用 setData )</p></li>
<li><p><strong>attached</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">function()</span></code></span>) – 组件生命周期函数-在组件实例进入页面节点树时执行)</p></li>
<li><p><strong>ready</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">function()</span></code></span>) – 组件生命周期函数-在组件布局完成后执行)</p></li>
<li><p><strong>moved</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">function()</span></code></span>) – 组件生命周期函数-在组件实例被移动到节点树另一个位置时执行)</p></li>
<li><p><strong>detached</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">function()</span></code></span>) – 组件生命周期函数-在组件实例被从页面节点树移除时执行)</p></li>
<li><p><strong>relations</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">object()</span></code></span>) – 组件间关系定义，参见 组件间关系</p></li>
<li><p><strong>externalClasses</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">string()</span></code></span>) – Array  否       组件接受的外部样式类，参见 外部样式类</p></li>
<li><p><strong>options</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">object()</span></code></span>) – Object Map      否       一些选项（文档中介绍相关特性时会涉及具体的选项设置，这里暂不列举）</p></li>
<li><p><strong>lifetimes</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">object()</span></code></span>) – 组件生命周期声明对象，参见 组件生命周期    2.2.3</p></li>
<li><p><strong>pageLifetimes</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">object()</span></code></span>) – 组件所在页面的生命周期声明对象，参见 组件生命周期       2.2.3</p></li>
<li><p><strong>definitionFilter</strong> (<span><code class="xref js js-func docutils literal notranslate"><span class="pre">function()</span></code></span>) – 定义段过滤器，用于自定义组件扩展，参见 自定义组件扩展 2.2.3</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>生成的组件实例可以在组件的方法、生命周期函数和属性 observer 中通过 this 访问。组件包含一些通用属性和方法。</p>
<p>属性名     类型      描述
is      String  组件的文件路径
id      String  节点id
dataset String  节点dataset
data    Object  组件数据，包括内部数据和属性值
properties      Object  组件数据，包括内部数据和属性值（与 data 一致）
方法名     参数      描述
setData Object newData  设置data并执行视图层渲染
hasBehavior     Object behavior 检查组件是否具有 behavior （检查时会递归检查被直接或间接引入的所有behavior）
triggerEvent    String name, Object detail, Object options      触发事件，参见 组件间通信与事件
createSelectorQuery             创建一个 SelectorQuery 对象，选择器选取范围为这个组件实例内
createIntersectionObserver              创建一个 IntersectionObserver 对象，选择器选取范围为这个组件实例内
selectComponent String selector 使用选择器选择组件实例节点，返回匹配到的第一个组件实例对象（会被 wx://component-export 影响）
selectAllComponents     String selector 使用选择器选择组件实例节点，返回匹配到的全部组件实例对象组成的数组
getRelationNodes        String relationKey      获取这个关系所对应的所有关联节点，参见 组件间关系
groupSetData    Function callback       立刻执行 callback ，其中的多个 setData 之间不会触发界面绘制（只有某些特殊场景中需要，如用于在不同组件同时 setData 时进行界面绘制同步）
getTabBar       无       返回当前页面的 custom-tab-bar 的组件实例，详见自定义 tabBar
代码示例：</p>
<p>在开发者工具中预览效果</p>
<p>Component({</p>
<blockquote>
<div><p>behaviors: [],</p>
<p>// 属性定义（详情参见下文）
properties: {</p>
<blockquote>
<div><dl class="simple">
<dt>myProperty: { // 属性名</dt><dd><p>type: String,
value: ‘’</p>
</dd>
</dl>
<p>},
myProperty2: String // 简化的定义方式</p>
</div></blockquote>
<p>},</p>
<p>data: {}, // 私有数据，可用于模板渲染</p>
<dl class="simple">
<dt>lifetimes: {</dt><dd><p>// 生命周期函数，可以为函数，或一个在methods段中定义的方法名
attached() { },
moved() { },
detached() { },</p>
</dd>
</dl>
<p>},</p>
<p>// 生命周期函数，可以为函数，或一个在methods段中定义的方法名
attached() { }, // 此处attached的声明会被lifetimes字段中的声明覆盖
ready() { },</p>
<dl class="simple">
<dt>pageLifetimes: {</dt><dd><p>// 组件所在页面的生命周期函数
show() { },
hide() { },
resize() { },</p>
</dd>
</dl>
<p>},</p>
<dl>
<dt>methods: {</dt><dd><dl>
<dt>onMyButtonTap() {</dt><dd><dl class="simple">
<dt>this.setData({</dt><dd><p>// 更新属性和数据的方法与更新页面数据的方法类似</p>
</dd>
</dl>
<p>})</p>
</dd>
</dl>
<p>},
// 内部方法建议以下划线开头
_myPrivateMethod() {</p>
<blockquote>
<div><p>// 这里将 data.A[0].B 设为 ‘myPrivateData’
this.setData({</p>
<blockquote>
<div><p>‘A[0].B’: ‘myPrivateData’</p>
</div></blockquote>
<p>})</p>
</div></blockquote>
<p>},
_propertyChange(newVal, oldVal) {</p>
<p>}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>})
注意：在 properties 定义段中，属性名采用驼峰写法（propertyName）；在 wxml 中，指定属性值时则对应使用连字符写法（component-tag-name property-name=”attr value”），应用于数据绑定时采用驼峰写法（attr=”{{propertyName}}”）。</p>
<p>properties 定义
定义段     类型      是否必填    描述      最低版本
type            是       属性的类型
optionalTypes   Array   否       属性的类型（可以指定多个）   2.6.5
value           否       属性的初始值
observer: 属性值变化时的回调函数
属性值的改变情况可以使用 observer 来监听。目前，在新版本基础库中不推荐使用这个字段，而是使用 Component 构造器的 observers 字段代替，它更加强大且性能更好。</p>
<p>代码示例：</p>
<dl>
<dt>Component({</dt><dd><dl>
<dt>properties: {</dt><dd><dl class="simple">
<dt>min: {</dt><dd><p>type: Number,
value: 0</p>
</dd>
</dl>
<p>},
min: {</p>
<blockquote>
<div><p>type: Number,
value: 0,
observer: function(newVal, oldVal) {</p>
<blockquote>
<div><p>// 属性值变化时执行</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
lastLeaf: {</p>
<blockquote>
<div><p>// 这个属性可以是 Number 、 String 、 Boolean 三种类型中的一种
type: Number,
optionalTypes: [String, Object],
value: 0</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>})
属性的类型可以为 String Number Boolean Object Array 其一，也可以为 null 表示不限制类型。</p>
<p>多数情况下，属性最好指定一个确切的类型。这样，在 WXML 中以字面量指定属性值时，值可以获得一个确切的类型，如：</p>
<p>&lt;custom-comp min=”1” max=”5” /&gt;
此时，由于自定义组件的对应属性被规定为 Number 类型， min 和 max 会被赋值为 1 和 5 ，而非 “1” 和 “5” ，即：</p>
<p>this.data.min === 1 // true
this.data.max === 5 // true
Bug &amp; Tips:
使用 this.data 可以获取内部数据和属性值，但不要直接修改它们，应使用 setData 修改。
生命周期函数无法在组件方法中通过 this 访问到。
属性名应避免以 data 开头，即不要命名成 dataXyz 这样的形式，因为在 WXML 中， data-xyz=”” 会被作为节点 dataset 来处理，而不是组件属性。
在一个组件的定义和使用时，组件的属性名和 data 字段相互间都不能冲突（尽管它们位于不同的定义段中）。
从基础库 2.0.9 开始，对象类型的属性和 data 字段中可以包含函数类型的子字段，即可以通过对象类型的属性字段来传递函数。低于这一版本的基础库不支持这一特性。
bug : 对于 type 为 Object 或 Array 的属性，如果通过该组件自身的 this.setData 来改变属性值的一个子字段，则依旧会触发属性 observer ，且 observer 接收到的 newVal 是变化的那个子字段的值， oldVal 为空， changedPath 包含子字段的字段名相关信息。
bug : 位于 slot 中的自定义组件没有触发 pageLifetimes 中声明的页面生命周期，此问题在 2.5.2 中修复。</p>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="../../http-routingtable.html" title="微信小程序API"
             >wxapi</a> |</li>
        <li class="right" >
          <a href="Behavior.html" title="Behavior"
             >下一页</a> |</li>
        <li class="right" >
          <a href="getCurrentPages.html" title="获取当前页面栈(getCurrentPages)"
             >上一页</a> |</li>
<li><a href="../../index.html">主页</a>&#160;|</li>
<li><a href="../../contents.html">文档</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" >参考资料</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >框架接口说明</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">创建自定义组件(Component)</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2019, Wxadev Docs.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.1.
    </div>
  </body>
</html>